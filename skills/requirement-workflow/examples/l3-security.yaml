# L3 Full Workflow with Security Focus
# L3 完整流程 - 安全导向配置
#
# Use case: Security-sensitive features, auth systems, data handling
# 适用场景: 安全敏感功能、认证系统、数据处理

level: L3
name: "Security-focused Development Template"
tags: ["security", "compliance"]

# Hook-based skill injection for comprehensive security workflow
# 基于钩子的全面安全工作流技能注入
hooks:
  # Analysis Phase Hooks
  post_stage_ANALYZING:
    - skill: threat-modeler
      required: true
      config:
        frameworks: ["STRIDE", "DREAD"]
        output_format: "markdown"
    - skill: compliance-checker
      required: false
      config:
        standards: ["OWASP", "GDPR"]

  # Design Phase Hooks
  pre_stage_DESIGNING:
    - skill: security-checklist-loader
      required: false
      config:
        template: "security_design_checklist"

  post_stage_DESIGNING:
    - skill: security-reviewer
      required: true
      config:
        checks:
          - "authentication"
          - "authorization"
          - "data_encryption"
          - "input_validation"
          - "session_management"
    - skill: architecture-reviewer
      required: false
      config:
        focus: ["security_boundaries", "trust_zones"]

  # Implementation Phase Hooks
  pre_stage_IMPLEMENTING:
    - skill: sast-scanner
      required: false
      config:
        rules: ["security"]
        severity_threshold: "medium"

  post_stage_IMPLEMENTING:
    - skill: dependency-scanner
      required: true
      config:
        check_vulnerabilities: true
        check_licenses: true
    - skill: secrets-scanner
      required: true
      config:
        patterns: ["api_keys", "passwords", "tokens"]

  # Testing Phase Hooks
  pre_stage_TESTING:
    - skill: security-test-runner
      required: true
      config:
        types:
          - "injection"
          - "xss"
          - "csrf"
          - "auth_bypass"

  post_stage_TESTING:
    - skill: dast-scanner
      required: false
      config:
        scan_depth: "full"
        authenticated: true
    - skill: penetration-test-assistant
      required: false
      config:
        mode: "assisted"
        report_format: "detailed"

  # Delivery Phase Hooks
  pre_stage_DELIVERING:
    - skill: security-report-generator
      required: true
    - skill: compliance-attestation
      required: false
      config:
        sign_off_required: true

  # Quality & Security Gates
  quality_gate:
    - skill: type-checker
      required: true
    - skill: lint-checker
      required: true
    - skill: sast-scanner
      required: true
      config:
        fail_on: "high"
    - skill: dependency-vulnerability-checker
      required: true

  pre_delivery:
    - skill: security-sign-off
      required: true
      config:
        require_approvals: ["security_team", "tech_lead"]

  on_blocked:
    - skill: security-incident-reporter
      required: false
      config:
        notify_team: true
        escalate_critical: true

# All artifacts required for L3 security workflow
# L3 安全流程需要所有产出物
required_artifacts:
  - spec.md
  - design.md
  - tasks.md
  - checklist.md
  - threat_model.md
  - security_review.md

# Extended documentation requirements
# 扩展的文档要求
documentation:
  threat_model: true
  security_controls: true
  data_flow_diagram: true
  compliance_mapping: true

# Mandatory reviews
# 强制审查
reviews:
  security_review: required
  architecture_review: required
  code_review: required
  compliance_review: required

# Notification settings
# 通知设置
notifications:
  on_blocked: true
  on_stage_complete: true
  on_workflow_complete: true
  security_alert: true
  channels: ["slack", "email"]
