# L3: Full Workflow / å®Œæ•´æµç¨‹

å¤æ‚åŠŸèƒ½å’Œå®‰å…¨æ•æ„Ÿéœ€æ±‚çš„å®Œæ•´å·¥ä½œæµã€‚

## Overview / æ¦‚è§ˆ

```
INIT â†’ ANALYZING(ext) â†’ PLANNING(ext) â†’ DESIGNING(ext) â†’ IMPLEMENTING â†’ TESTING â†’ DELIVERING â†’ DONE
```

| å±æ€§ | å€¼ |
|------|-----|
| ç›®æ ‡æ—¶é—´ | > 8 å°æ—¶ (å¯èƒ½è·¨å¤©) |
| äº§å‡ºç‰© | å…¨éƒ¨æ–‡æ¡£ + å¨èƒæ¨¡å‹ + å®¡æ‰¹è®°å½• |
| å¼ºåˆ¶è¦æ±‚ | å®‰å…¨å®¡æŸ¥, æ¶æ„å®¡æ‰¹ |
| é€‚ç”¨ | å®‰å…¨åŠŸèƒ½, è·¨æ¨¡å—é‡æ„, ç ´åæ€§å˜æ›´ |

## L3 vs L2 / ä¸ L2 çš„å·®å¼‚

| é˜¶æ®µ | L2 | L3 æ‰©å±•å†…å®¹ |
|------|-----|-------------|
| ANALYZING | éœ€æ±‚æ¾„æ¸… | + å¨èƒå»ºæ¨¡, å½±å“åˆ†æ |
| PLANNING | ä»»åŠ¡è§„åˆ’ | + èµ„æºè§„åˆ’, å›æ»šç­–ç•¥ |
| DESIGNING | æŠ€æœ¯è®¾è®¡ | + æ¶æ„å®¡æŸ¥, å®‰å…¨å®¡æŸ¥ |
| TESTING | è´¨é‡æ£€æŸ¥ | + å®‰å…¨æµ‹è¯•, æ¸—é€æµ‹è¯• |
| DELIVERING | ç”ŸæˆæŠ¥å‘Š | + åˆè§„ç­¾å­—, å®¡æ‰¹æµç¨‹ |

## Stages / é˜¶æ®µè¯¦æƒ…

### Stage 1: INIT â†’ ANALYZING (Extended)

**è§¦å‘:** å·¥ä½œæµåˆå§‹åŒ–å®Œæˆå

**L3 æ‰©å±•å†…å®¹:**
1. æ ‡å‡†éœ€æ±‚åˆ†æ (åŒ L2)
2. **å¨èƒå»ºæ¨¡** (STRIDE/DREAD)
3. **å½±å“åˆ†æ** (å“ªäº›ç³»ç»Ÿ/å›¢é˜Ÿå—å½±å“)
4. **é£é™©è¯„ä¼°çŸ©é˜µ**

**äº§å‡º:**

spec.md (æ‰©å±•ç‰ˆ):
```markdown
# éœ€æ±‚è§„æ ¼: {name}

## èƒŒæ™¯ / ç›®æ ‡ / èŒƒå›´
{åŒ L2}

## å¨èƒæ¨¡å‹
| å¨èƒç±»å‹ | æè¿° | é£é™©ç­‰çº§ | ç¼“è§£æªæ–½ |
|----------|------|----------|----------|
| Spoofing | ... | é«˜ | ... |
| Tampering | ... | ä¸­ | ... |

## å½±å“åˆ†æ
- å—å½±å“ç³»ç»Ÿ: {åˆ—è¡¨}
- å—å½±å“å›¢é˜Ÿ: {åˆ—è¡¨}
- æ•°æ®è¿ç§»éœ€æ±‚: {æ˜¯/å¦}

## é£é™©è¯„ä¼°
| é£é™© | æ¦‚ç‡ | å½±å“ | ç­‰çº§ | ç¼“è§£ |
|------|------|------|------|------|
```

**çŠ¶æ€è½¬æ¢:**
```bash
./scripts/advance-stage.sh -r /project --to ANALYZING
```

### Stage 2: ANALYZING â†’ PLANNING (Extended)

**è§¦å‘:** éœ€æ±‚åˆ†æå’Œå¨èƒå»ºæ¨¡å®Œæˆ

**L3 æ‰©å±•å†…å®¹:**
1. æ ‡å‡†ä»»åŠ¡è§„åˆ’ (åŒ L2)
2. **èµ„æºè§„åˆ’** (éœ€è¦å“ªäº›äººå‚ä¸)
3. **æ—¶é—´çº¿ä¼°ç®—**
4. **ä¾èµ–æ˜ å°„**
5. **å›æ»šç­–ç•¥**

**äº§å‡º (tasks.md æ‰©å±•):**
```markdown
# ä»»åŠ¡åˆ—è¡¨

## èµ„æºéœ€æ±‚
- å¼€å‘: 2äºº
- å®‰å…¨å®¡æŸ¥: 1äºº
- æµ‹è¯•: 1äºº

## æ—¶é—´çº¿
| é˜¶æ®µ | é¢„ä¼°æ—¶é—´ | è´Ÿè´£äºº |
|------|----------|--------|
| è®¾è®¡ | 2å¤© | ... |
| å¼€å‘ | 3å¤© | ... |

## ä¾èµ–
- å¤–éƒ¨: {åˆ—è¡¨}
- å†…éƒ¨: {åˆ—è¡¨}

## å›æ»šç­–ç•¥
1. æ£€æµ‹æŒ‡æ ‡: {ä»€ä¹ˆæƒ…å†µè§¦å‘å›æ»š}
2. å›æ»šæ­¥éª¤: {å…·ä½“æ“ä½œ}
3. éªŒè¯æ–¹æ³•: {ç¡®è®¤å›æ»šæˆåŠŸ}

## ä»»åŠ¡åˆ—è¡¨
{è¯¦ç»†ä»»åŠ¡}
```

**çŠ¶æ€è½¬æ¢:**
```bash
./scripts/advance-stage.sh -r /project --to PLANNING
```

### Stage 3: PLANNING â†’ DESIGNING (Extended)

**è§¦å‘:** è§„åˆ’å®Œæˆ

**L3 æ‰©å±•å†…å®¹:**
1. æ ‡å‡†æŠ€æœ¯è®¾è®¡ (åŒ L2)
2. **æ¶æ„å®¡æŸ¥**
3. **å®‰å…¨è®¾è®¡å®¡æŸ¥**
4. **æ€§èƒ½å½±å“åˆ†æ**
5. **è¿ç§»è®¡åˆ’** (å¦‚é€‚ç”¨)

**äº§å‡º (design.md æ‰©å±•):**
```markdown
# æŠ€æœ¯è®¾è®¡: {name}

## æ–¹æ¡ˆæ¦‚è¿° / API è®¾è®¡
{åŒ L2}

## æ¶æ„å®¡æŸ¥
### å®‰å…¨è¾¹ç•Œ
{ä¿¡ä»»åŸŸåˆ’åˆ†}

### æ•°æ®æµ
{æ•æ„Ÿæ•°æ®å¦‚ä½•æµåŠ¨}

### è®¤è¯/æˆæƒ
{è®¿é—®æ§åˆ¶è®¾è®¡}

## å®‰å…¨æ§åˆ¶
| æ§åˆ¶é¡¹ | å®ç°æ–¹å¼ | éªŒè¯æ–¹æ³• |
|--------|----------|----------|
| è¾“å…¥éªŒè¯ | ... | ... |
| åŠ å¯†å­˜å‚¨ | ... | ... |
| å®¡è®¡æ—¥å¿— | ... | ... |

## æ€§èƒ½å½±å“
- é¢„æœŸ QPS: {æ•°å€¼}
- å»¶è¿Ÿå½±å“: {é¢„ä¼°}
- èµ„æºæ¶ˆè€—: {é¢„ä¼°}

## è¿ç§»è®¡åˆ’ (å¦‚é€‚ç”¨)
1. å‡†å¤‡é˜¶æ®µ
2. æ•°æ®è¿ç§»
3. åˆ‡æ¢éªŒè¯
4. å›æ»šé¢„æ¡ˆ
```

**å®¡æ‰¹è¦æ±‚:**
```yaml
required_approvals:
  - role: security_team
    status: pending
  - role: tech_lead  
    status: pending
```

**çŠ¶æ€è½¬æ¢:**
```bash
./scripts/advance-stage.sh -r /project --to DESIGNING
```

### Stage 4: DESIGNING â†’ IMPLEMENTING

**è§¦å‘:** è®¾è®¡å®Œæˆ **ä¸”** å¿…è¦å®¡æ‰¹é€šè¿‡

**AI æ‰§è¡Œ:**
1. ç¡®è®¤æ‰€æœ‰å®¡æ‰¹å·²é€šè¿‡
2. æŒ‰è®¡åˆ’æ‰§è¡Œå¼€å‘ä»»åŠ¡
3. å®æ—¶æ‰«æå®‰å…¨é—®é¢˜

**å®‰å…¨å¼€å‘è¦æ±‚:**
- å¯ç”¨ SAST æ‰«æ
- ä¾èµ–æ¼æ´æ£€æŸ¥
- å¯†é’¥æ³„éœ²æ£€æµ‹

**çŠ¶æ€è½¬æ¢:**
```bash
./scripts/advance-stage.sh -r /project --to IMPLEMENTING
```

### Stage 5: IMPLEMENTING â†’ TESTING (Extended)

**è§¦å‘:** å¼€å‘å®Œæˆ

**L3 æ‰©å±•å†…å®¹:**
1. æ ‡å‡†æµ‹è¯• (åŒ L2)
2. **å®‰å…¨æµ‹è¯•**
   - æ³¨å…¥æµ‹è¯• (SQL, XSS, CSRF)
   - è®¤è¯ç»•è¿‡æµ‹è¯•
   - æƒé™æå‡æµ‹è¯•
3. **æ¸—é€æµ‹è¯•** (è¾…åŠ©)
4. **æ€§èƒ½æµ‹è¯•** (å¦‚é€‚ç”¨)

**äº§å‡º (checklist.md æ‰©å±•):**
```markdown
# éªŒæ”¶æ¸…å•

## åŠŸèƒ½éªŒè¯
{åŒ L2}

## å®‰å…¨éªŒè¯
- [ ] SAST æ‰«æé€šè¿‡
- [ ] DAST æ‰«æé€šè¿‡
- [ ] ä¾èµ–æ¼æ´æ£€æŸ¥é€šè¿‡
- [ ] æ•æ„Ÿæ•°æ®åŠ å¯†éªŒè¯
- [ ] è®¿é—®æ§åˆ¶æµ‹è¯•é€šè¿‡
- [ ] å®¡è®¡æ—¥å¿—éªŒè¯

## æ€§èƒ½éªŒè¯
- [ ] è´Ÿè½½æµ‹è¯•é€šè¿‡
- [ ] å“åº”æ—¶é—´è¾¾æ ‡
- [ ] èµ„æºæ¶ˆè€—åœ¨é¢„ç®—å†…
```

**çŠ¶æ€è½¬æ¢:**
```bash
./scripts/advance-stage.sh -r /project --to TESTING
```

### Stage 6: TESTING â†’ DELIVERING (Extended)

**è§¦å‘:** æ‰€æœ‰æµ‹è¯• (åŒ…æ‹¬å®‰å…¨æµ‹è¯•) é€šè¿‡

**L3 æ‰©å±•å†…å®¹:**
1. ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
2. **åˆè§„æ–‡æ¡£**
3. **æœ€ç»ˆå®‰å…¨ç­¾å­—**
4. **éƒ¨ç½²æ‰¹å‡†**

**äº§å‡º:**

artifacts/security_review.md:
```markdown
# å®‰å…¨å®¡æŸ¥æŠ¥å‘Š

## å®¡æŸ¥æ‘˜è¦
| é¡¹ç›® | çŠ¶æ€ |
|------|------|
| å¨èƒå»ºæ¨¡ | âœ… å®Œæˆ |
| å®‰å…¨è®¾è®¡å®¡æŸ¥ | âœ… é€šè¿‡ |
| SAST æ‰«æ | âœ… æ— é«˜å± |
| æ¸—é€æµ‹è¯• | âœ… é€šè¿‡ |

## å‘ç°é—®é¢˜
| é—®é¢˜ | ä¸¥é‡åº¦ | çŠ¶æ€ |
|------|--------|------|
| {é—®é¢˜1} | ä¸­ | å·²ä¿®å¤ |

## ç­¾å­—
- å®‰å…¨å›¢é˜Ÿ: _______
- Tech Lead: _______
```

**çŠ¶æ€è½¬æ¢:**
```bash
./scripts/advance-stage.sh -r /project --to DELIVERING
```

### Stage 7: DELIVERING â†’ DONE

**è§¦å‘:** æ‰€æœ‰ç­¾å­—å®Œæˆ

**AI æ‰§è¡Œ:**
1. ç¡®è®¤æ‰€æœ‰å®¡æ‰¹
2. ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
3. å½’æ¡£æ‰€æœ‰æ–‡æ¡£
4. æ ‡è®°å®Œæˆ

**çŠ¶æ€è½¬æ¢:**
```bash
./scripts/advance-stage.sh -r /project --to DONE
```

## Complete Example / å®Œæ•´ç¤ºä¾‹

### åœºæ™¯: é›†æˆ OAuth 2.0 ç¬¬ä¸‰æ–¹ç™»å½•

```
User: éœ€è¦é›†æˆ OAuth 2.0 æ”¯æŒ Google/GitHub ç¬¬ä¸‰æ–¹ç™»å½•

AI: è¿™æ˜¯å®‰å…¨æ•æ„ŸåŠŸèƒ½ï¼Œæˆ‘ä½¿ç”¨ L3 å®Œæ•´æµç¨‹ã€‚

ğŸ“Š éœ€æ±‚åˆ†æ:
- ç±»å‹: feature
- çº§åˆ«: L3 (Full)
- å®‰å…¨ç­‰çº§: é«˜
- å½±å“: è®¤è¯ç³»ç»Ÿ, ç”¨æˆ·æ¨¡å—

æ­£åœ¨åˆå§‹åŒ–å·¥ä½œæµ...

âœ… Workflow: 20240115_001_feature_oauth-integration
ğŸ“ .trae/workflow/20240115_001_feature_oauth-integration/

---

[ANALYZING - Extended] æ·±åº¦éœ€æ±‚åˆ†æ

ğŸ“„ éœ€æ±‚è§„æ ¼å·²è®°å½•

æ‰§è¡Œå¨èƒå»ºæ¨¡ (STRIDE):
| å¨èƒ | é£é™© | ç¼“è§£ |
|------|------|------|
| Spoofing (ä¼ªè£…) | é«˜ | éªŒè¯ OAuth state å‚æ•° |
| Tampering (ç¯¡æ”¹) | ä¸­ | HTTPS + ç­¾åéªŒè¯ |
| Repudiation (æŠµèµ–) | ä½ | å®¡è®¡æ—¥å¿— |
| Info Disclosure | é«˜ | æœ€å°æƒé™ scope |
| DoS | ä¸­ | é€Ÿç‡é™åˆ¶ |
| Elevation | é«˜ | ä¸¥æ ¼æƒé™æ˜ å°„ |

å½±å“åˆ†æ:
- å—å½±å“ç³»ç»Ÿ: Auth Service, User Service, Frontend
- éœ€è¦åè°ƒ: åç«¯å›¢é˜Ÿ, å®‰å…¨å›¢é˜Ÿ

æ¨è¿›åˆ° PLANNING...

---

[PLANNING - Extended] èµ„æºä¸æ—¶é—´è§„åˆ’

ğŸ“‹ ä»»åŠ¡è§„åˆ’:
- è®¾è®¡é˜¶æ®µ: 2å¤©
- å¼€å‘é˜¶æ®µ: 3å¤©
- æµ‹è¯•é˜¶æ®µ: 2å¤©
- å®¡æ‰¹: 1å¤©

å›æ»šç­–ç•¥:
- è§¦å‘æ¡ä»¶: è®¤è¯å¤±è´¥ç‡ > 1%
- å›æ»šæ–¹å¼: Feature Flag å…³é—­
- éªŒè¯: åŸæœ‰ç™»å½•æ­£å¸¸

æ¨è¿›åˆ° DESIGNING...

---

[DESIGNING - Extended] æ¶æ„ä¸å®‰å…¨è®¾è®¡

ğŸ“„ design.md å·²åˆ›å»º:

å®‰å…¨è®¾è®¡:
- OAuth State: åŠ å¯†éšæœºæ•° + æ—¶é—´æˆ³
- Token å­˜å‚¨: åŠ å¯†å­˜å‚¨åœ¨ HttpOnly Cookie
- Scope: æœ€å°æƒé™ (email, profile)
- è´¦æˆ·ç»‘å®š: éœ€è¦éªŒè¯å·²æœ‰è´¦æˆ·

ğŸ”’ éœ€è¦å®¡æ‰¹:
- [ ] å®‰å…¨å›¢é˜Ÿå®¡æŸ¥
- [ ] Tech Lead å®¡æ‰¹

ç­‰å¾…å®¡æ‰¹ä¸­...

User: å®‰å…¨å›¢é˜Ÿå’Œ Tech Lead éƒ½å·²å®¡æ‰¹

AI: å®¡æ‰¹å·²è®°å½•ï¼Œæ¨è¿›åˆ°å®ç°é˜¶æ®µ...

---

[IMPLEMENTING] ç¼–ç å®ç°

å¯ç”¨å®‰å…¨æ‰«æ:
- âœ… SAST æ‰«æå™¨å·²æ³¨å…¥
- âœ… ä¾èµ–æ¼æ´æ£€æµ‹å·²å¯ç”¨
- âœ… å¯†é’¥æ³„éœ²æ£€æµ‹å·²å¯ç”¨

æ‰§è¡Œå¼€å‘ä»»åŠ¡...
(è¯¦ç»†ä»»åŠ¡æ‰§è¡Œ)

æ¨è¿›åˆ° TESTING...

---

[TESTING - Extended] å®‰å…¨æµ‹è¯•

æ ‡å‡†æµ‹è¯•:
- âœ… å•å…ƒæµ‹è¯•é€šè¿‡
- âœ… é›†æˆæµ‹è¯•é€šè¿‡

å®‰å…¨æµ‹è¯•:
- âœ… OAuth State éªŒè¯æµ‹è¯•
- âœ… CSRF é˜²æŠ¤æµ‹è¯•
- âœ… Token å®‰å…¨æ€§æµ‹è¯•
- âœ… æƒé™æå‡æµ‹è¯•
- âœ… SAST æ‰«ææ— é«˜å±
- âœ… ä¾èµ–æ¼æ´æ£€æŸ¥é€šè¿‡

æ¨è¿›åˆ° DELIVERING...

---

[DELIVERING - Extended] åˆè§„ç­¾å­—

ç”Ÿæˆå®‰å…¨å®¡æŸ¥æŠ¥å‘Š...

ğŸ“„ artifacts/security_review.md å·²åˆ›å»º

æœ€ç»ˆç­¾å­—:
- âœ… å®‰å…¨å›¢é˜Ÿ: å·²ç­¾å­—
- âœ… Tech Lead: å·²ç­¾å­—

æ¨è¿›åˆ° DONE...

---

[DONE] å·¥ä½œæµå®Œæˆ

âœ… OAuth 2.0 é›†æˆå·²å®Œæˆï¼

ğŸ“Š æœ€ç»ˆæŠ¥å‘Š:
- æ–°å¢æ–‡ä»¶: 12
- ä¿®æ”¹æ–‡ä»¶: 8
- å®‰å…¨å®¡æŸ¥: é€šè¿‡
- æµ‹è¯•è¦†ç›–: 82%
- æ€»ç”¨æ—¶: 5å¤©

ğŸ“ äº§å‡ºç‰©:
- spec.md (å«å¨èƒæ¨¡å‹)
- design.md (å«å®‰å…¨è®¾è®¡)
- security_review.md
- report.md
```

## Required Approvals / å¿…éœ€å®¡æ‰¹

L3 æµç¨‹çš„å¼ºåˆ¶å®¡æ‰¹ç‚¹:

| é˜¶æ®µ | å®¡æ‰¹äºº | å†…å®¹ |
|------|--------|------|
| DESIGNING å®Œæˆå | å®‰å…¨å›¢é˜Ÿ | å®‰å…¨è®¾è®¡å®¡æŸ¥ |
| DESIGNING å®Œæˆå | Tech Lead | æ¶æ„å®¡æŸ¥ |
| DELIVERING å‰ | å®‰å…¨å›¢é˜Ÿ | å®‰å…¨æµ‹è¯•ç­¾å­— |
| DELIVERING å‰ | äº§å“/åˆè§„ | ä¸Šçº¿å®¡æ‰¹ (å¦‚éœ€è¦) |

## Quality Gate / è´¨é‡é—¨ç¦

L3 çš„å®Œæ•´è´¨é‡æ£€æŸ¥:

```yaml
quality_gate:
  lint: required
  type_check: required
  unit_tests: required
  coverage_threshold: 80%
  integration_tests: required
  sast_scan: required
  dependency_scan: required
  security_tests: required
```

## Hooks / å¯ç”¨é’©å­

L3 çš„æ‰€æœ‰é’©å­:

```
pre_stage_{STAGE}         # è¿›å…¥é˜¶æ®µå‰
post_stage_{STAGE}        # å®Œæˆé˜¶æ®µå
pre_task_{task_id}        # æ‰§è¡Œä»»åŠ¡å‰
post_task_{task_id}       # å®Œæˆä»»åŠ¡å
quality_gate              # è´¨é‡æ£€æŸ¥æ—¶
security_review           # å®‰å…¨å®¡æŸ¥æ—¶
architecture_review       # æ¶æ„å®¡æŸ¥æ—¶
pre_delivery              # äº¤ä»˜å‰
on_blocked                # é˜»å¡æ—¶
on_error                  # å‡ºé”™æ—¶
on_approval_required      # éœ€è¦å®¡æ‰¹æ—¶
```

## Skill Injection / æŠ€èƒ½æ³¨å…¥

L3 æ¨è/å¿…éœ€çš„æŠ€èƒ½:

```yaml
injected_skills:
  - stage: ANALYZING
    skill: threat-modeler
    timing: post
    required: true

  - stage: DESIGNING
    skill: security-reviewer
    timing: post
    required: true

  - stage: IMPLEMENTING
    skill: sast-scanner
    timing: during
    required: true

  - stage: IMPLEMENTING
    skill: dependency-scanner
    timing: post
    required: true

  - stage: TESTING
    skill: security-test-runner
    timing: during
    required: true

  - stage: DELIVERING
    skill: compliance-checker
    timing: pre
    required: true
```

## Blocked Handling / é˜»å¡å¤„ç†

L3 çš„ç‰¹æ®Šé˜»å¡æƒ…å†µ:

| é˜»å¡åŸå›  | å¤„ç†æ–¹å¼ |
|----------|----------|
| å®‰å…¨å®¡æŸ¥ä¸é€šè¿‡ | ä¿®å¤åé‡æ–°å®¡æŸ¥ |
| å‘ç°é«˜å±æ¼æ´ | åœæ­¢å¼€å‘ï¼Œä¼˜å…ˆä¿®å¤ |
| å®¡æ‰¹è¶…æ—¶ | é€šçŸ¥ç›¸å…³äººï¼Œç­‰å¾…æˆ–å‡çº§ |
| æ¸—é€æµ‹è¯•å‘ç°é—®é¢˜ | è®°å½•å¹¶ä¿®å¤åé‡æµ‹ |
